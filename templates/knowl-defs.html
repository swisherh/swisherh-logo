{# 
   the following KNOWL macro enables to tag certain locations in the
   HTML documents to reference to saved "Knowls". They contain all
   the information and form the stored knowledge. The macro itself
   is only there for the presentation of the data via suitable
   HTML tags and associated javascript code.
#}
{% macro KNOWL(knowlid, tag='span', title=none) -%}
  {% with knowl = Knowl(knowlid) -%}
    {% if knowl.exists() -%}
      {% if title is none -%}
         <{{tag}} class="knowl-title">{{ knowl.title }}</{{tag}}>
      {%- else -%}
        {% if title|length > 0 -%}
         <{{tag}} class="knowl-title">{{ title }}</{{tag}}>
        {%- endif %}
      {%- endif %}
      <span knowl="{{ knowl.id }}" class="knowl-qm">?</span>

    {%- else -%}
      {# knowl does not exist. wrong knowlid or opportunity to create one! #}
      <{{tag}} class="knowl knowl-error">
        {% if user.is_authenticated() -%}
          [ERROR: Knowl with ID '{{knowlid}}' does not exist. Wrong ID or
          <a href="{{ url_for('knowledge.edit', ID=knowlid) }}">create a new one</a>.]
        {%- else -%}
          ['{{knowlid}}' missing ]
        {%- endif %}
      </{{tag}}>
    {%- endif %}
  {%- endwith %}
{%- endmacro %}
